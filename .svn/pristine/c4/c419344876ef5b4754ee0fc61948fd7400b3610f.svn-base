package tw.edu.ntut.csie.game.state;

import java.util.HashMap;
import java.util.Map;

import android.util.Log;

import tw.edu.ntut.csie.game.Game;
import tw.edu.ntut.csie.game.R;
import tw.edu.ntut.csie.game.core.MovingBitmap;
import tw.edu.ntut.csie.game.engine.GameEngine;
import tw.edu.ntut.csie.game.extend.Animation;
import tw.edu.ntut.csie.game.extend.BitmapButton;
import tw.edu.ntut.csie.game.extend.ButtonEventHandler;
import tw.edu.ntut.csie.game.extend.Integer;
import tw.edu.ntut.csie.game.state.AbstractGameState;

public class StateOver extends AbstractGameState {
	private BitmapButton _menuButton;
	private MovingBitmap _under;
	private MovingBitmap _background;
	
	//private MovingBitmap _scoreRank;
	private Integer _scores;
	private int default_score_digit;
	private MovingBitmap _yourScore;
	
	private BitmapButton _startButton;
	
	private Animation _tap;
	private MovingBitmap _tapFrame1;
	private MovingBitmap _tapFrame2;
	private MovingBitmap _tapFrame3;
	private MovingBitmap _tapFrame4;
	
	
	public StateOver(GameEngine engine) {
		super(engine);
	}

	@Override
	public void initialize(Map<String, Object> data) {
		int _score = (java.lang.Integer)data.get("score");
		Log.d("score", "_scores.getValue "+_score);
		default_score_digit = 4;
		if(_score > 10000) default_score_digit = 5;
		addGameObject(_scores = new Integer(default_score_digit, _score, 50, 210));
		
		//¤À¼Æ®Ø
		addGameObject(_yourScore = new MovingBitmap(R.drawable.yourscore));
		_yourScore.resize( (int)(_yourScore.getWidth()*0.6), (int)(_yourScore.getHeight()*0.6) );
		_yourScore.setLocation(25, 130);
		
		
		addGameObject(_background = new MovingBitmap(R.drawable.background));
		//_background.resize(386, 642);
		_background.resize(410, 681);
		_background.setLocation(-4, -15);
		
		//addGameObject(_startButton = new BitmapButton(R.drawable.background, R.drawable.background, -4, -15, 386, 642));
		//_startButton.addButtonEventHandler(new ButtonEventHandler() {
		//	@Override
		//	public void perform(BitmapButton button) {
				//Map<String, Object> paras = new HashMap<String, Object>();
				//paras.put("jellyLocation", 188 /*_role.getX()*/);
		/*		changeState(Game.INITIAL_STATE);//, paras);
			}
		});
		addPointerEventHandler(_startButton);*/
		initializeStartButton();
				
				
		addGameObject(_under = new MovingBitmap(R.drawable.under));
		_under.resize((int)(_under.getWidth()*0.64), (int)(_under.getHeight()*0.64));
		_under.setLocation((376/2)-(_under.getWidth()/2), 640-_under.getHeight()+27);
		
		/*
		_menuButton = new BitmapButton(R.drawable.menu, R.drawable.menu_pressed, 150, 50, 160, 40);
		_menuButton.addButtonEventHandler(new ButtonEventHandler() {
			@Override
			public void perform(BitmapButton button) {
				changeState(Game.INITIAL_STATE);
			}
		});
		addGameObject(_menuButton);
		addPointerEventHandler(_menuButton);
		*/
		_tapFrame1 = new MovingBitmap(R.drawable.tap_to_play);
		_tapFrame1.resize((int)(_tapFrame1.getWidth()*0.63), (int)(_tapFrame1.getHeight()*0.63));
		_tapFrame2 = new MovingBitmap(R.drawable.tap_to_play_visible_75); 
		_tapFrame2.resize((int)(_tapFrame2.getWidth()*0.63), (int)(_tapFrame2.getHeight()*0.63));
		_tapFrame3 = new MovingBitmap(R.drawable.tap_to_play_visible);
		_tapFrame3.resize((int)(_tapFrame3.getWidth()*0.63), (int)(_tapFrame3.getHeight()*0.63));
		_tapFrame4 = new MovingBitmap(R.drawable.tap_to_play_visible_75); 
		_tapFrame4.resize((int)(_tapFrame4.getWidth()*0.63), (int)(_tapFrame4.getHeight()*0.63));
		
		addGameObject(_tap = new Animation());
		_tap.addFrame(_tapFrame1);
		_tap.addFrame(_tapFrame2);
		_tap.addFrame(_tapFrame3);
		_tap.addFrame(_tapFrame4);
		_tap.setLocation(61, 425);
		_tap.setDelay(3);
		
		
		_startButton.setVisible(true);
		_background.setVisible(true);
		
		_yourScore.setVisible(true);

		_tap.setVisible(true);
		_under.setVisible(true);
	}

	@Override
	public void move() {
		super.move();
	}

	@Override
	public void pause() {}

	@Override
	public void resume() {}

	@Override
	public void show() {
		// TODO Auto-generated method stub
		super.show();
		_yourScore.show();
		_scores.show();
	}

	private void initializeStartButton() {
		addGameObject(_startButton = new BitmapButton(R.drawable.backgroundtransparent, R.drawable.backgroundtransparent, -4, 325));//, 386, 150));//-10, 386, 642));
		//_startButton.Resize(386, 150);
		_startButton.addButtonEventHandler(new ButtonEventHandler() {
			@Override
			public void perform(BitmapButton button) {
				Map<String, Object> paras = new HashMap<String, Object>();
				paras.put("jellyLocation", 188);
				changeState(Game.RUNNING_STATE,  paras);
			}
		});
		addPointerEventHandler(_startButton);
	}

}